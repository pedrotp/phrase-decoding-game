<!DOCTYPE html>
<html>
<head>
  <title>Phrase Decoding Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
  <link href="css/bootstrap-theme.min.css" rel="stylesheet" media="screen">
  <link href="css/styles.css" rel="stylesheet" media="screen">
  <script src="js/jquery-2.1.4.js" type="text/javascript"></script>
  <script src="js/bootstrap.js" type="text/javascript"></script>
</head>
<body>
  <div class="container">
    <header class="page-header">
      <h1>Guess the secret code!</h1>
    </header>
    <div id="instructions">
      <p>Below is a well-known movie quote, encoded with a simple <a href="https://en.wikipedia.org/wiki/Substitution_cipher">substitution cipher</a>. Symbols represent letters, and red slashes represent spaces. Click any symbol to enter a guess as to which letter that symbol represents. You only have <strong>5 guesses</strong>, so choose <em>wisely</em>.</p>
    </div>
    <div class="jumbotron center-text" id="secret-div">
    </div>
    <div id="errors"></div>
    <div id="guess-container">
      <div class="center-block">
        <h3 class="center-text">What does <span id="guess-icon" class="glyphicon glyphicon-asterisk"></span> stand for?</h3>
      </div>
      <div>
        <form class="form-inline center-text" onsubmit="return false">
          <div class="form-group">
            <label for="guess-box" id="guess-label">My guess: </label> 
            <input type="text" class="form-control center-block center-text" id="guess-box" autocomplete="off" name="guess-box" maxlength="1" onkeydown="if (event.keyCode == 13) guess()"/>
          </div>
            <button type="button" class="btn btn-default" id="guess-button" onclick="guess()">Submit</button>      
        </form>
      </div>
    </div>
    <footer><hr/>&copy; 2015 Pedro Torres-Pic√≥n. Icons provided by <a href="http://glyphicons.com">glyphicons.com</a>.</footer>
  </div>


  <script type="text/javascript">

    var guessCount = 5;

    document.getElementById("guess-box").focus();

    function generateAlphabet() {
      var icons = ["search","scissors","education","sunglasses","piggy-bank","apple","king","queen",
                    "tree-conifer","briefcase","eye-open","plane","gift","fire","picture",
                    "facetime-video","tint","camera","headphones","trash","book","cog","home",
                    "user","music","heart","cloud","star"]; 
      var newAlpha = {};
      for (var i = 0, alpha = "a"; i < 26; i++) {
        var pos = Math.floor(Math.random() * (icons.length - 1));
        newAlpha[alpha] = icons[pos];
        icons.splice(pos,1);
        alpha = String.fromCharCode(alpha.charCodeAt(0) + 1);
      }
      return newAlpha;
    };

    var thisAlpha = generateAlphabet();

    function encodePhrase(phrase,alphabet) {
      var aZ = Object.keys(alphabet), letters = phrase.split("");
      var result = letters.map(function(letter) {
        if (/\w/.test(letter)) {
          return alphabet[letter.toLowerCase()];
        }
        else if (letter == " ") {
          return " / "
        }
        else {
          return ""; //letter;
        };
      });
      return result;  
    };

    function createSecret(encodedPhrase) {
      var secret = document.createElement("h2");
      secret.id = "secret-h2";
      encodedPhrase.forEach(function(letter) {
        var newSpan = document.createElement("span");
        if (/\W/.test(letter[0]) || letter.length == 1) {
          newSpan.appendChild(document.createTextNode(letter));
          newSpan.style.color = "red";
          newSpan.style.fontSize = "1.5em";
        }
        else {
          newSpan.setAttribute("class","glyphicon glyphicon-" + letter);
          newSpan.setAttribute("onClick","changeIcon(\"" + letter + "\")");
        };
        secret.appendChild(newSpan);
      });
      return secret;
    }

    var thisSecret = encodePhrase("Hello", thisAlpha);
    document.getElementById("secret-div").appendChild(createSecret(thisSecret));

    function changeIcon(code) {
      var icon = document.getElementById("guess-icon");
      icon.setAttribute("class","glyphicon glyphicon-" + code);
      document.getElementById("guess-box").focus();
    };

    function wrongAlert() {
      var alert = document.createElement("div");
      if (document.getElementById("errors").childNodes.length > 2) document.getElementById("errors").removeChild(document.getElementById("errors").firstChild);
      alert.innerHTML = '<div class="alert alert-danger alert-dismissible in flash" role="alert" id="wrong-guess"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Wrong guess!</strong> You have ' + guessCount + ' guesses left.</div>';
      document.getElementById("errors").appendChild(alert);
      window.setTimeout(function() {
        $(".flash").fadeTo(500, 0).slideUp(500, function(){
          $(this).remove();
        });
      }, 2500); 
    };

    function asteriskAlert() {
      var alert = document.createElement("div");
      if (document.getElementById("errors").childNodes.length > 2) document.getElementById("errors").removeChild(document.getElementById("errors").firstChild);
      alert.innerHTML = '<div class="alert alert-warning alert-dismissible in flash" role="alert" id="wrong-guess"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Whoops!</strong> You must select an icon from above before you guess.</div>';
      document.getElementById("errors").appendChild(alert);
      window.setTimeout(function() {
        $(".flash").fadeTo(500, 0).slideUp(500, function(){
          $(this).remove();
        });
      }, 2500); 
    };

    function correctAlert() {
      var alert = document.createElement("div");
      if (document.getElementById("errors").childNodes.length > 2) document.getElementById("errors").removeChild(document.getElementById("errors").firstChild);
      alert.innerHTML = '<div class="alert alert-success alert-dismissible in flash" role="alert" id="wrong-guess"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Well done!</strong> Keep guessing, you\'re almost there.</div>';
      document.getElementById("errors").appendChild(alert);
      window.setTimeout(function() {
        $(".flash").fadeTo(500, 0).slideUp(500, function(){
          $(this).remove();
        });
      }, 2500); 
    };

    function guess() {
      var guess = document.getElementById("guess-box").value.toLowerCase();
      var icon = document.getElementById("guess-icon").className.replace("glyphicon glyphicon-","");
      if (icon == "asterisk") {
        asteriskAlert();
        document.getElementById("guess-box").value = "";
      }
      else if (thisAlpha[guess] == icon) {
        correctAlert();
        thisSecret = decode(icon,guess);
        document.getElementById("secret-div").replaceChild(createSecret(thisSecret),document.getElementById("secret-h2"));
        document.getElementById("guess-box").value = "";
        if (thisSecret.every(function(e) { return e.length == 1 || e === " / "})) {
          var pic = document.createElement("img");
          pic.src = "img/confetti_celebrate.gif";
          while (document.getElementById("errors").hasChildNodes()) {
            document.getElementById("errors").removeChild(document.getElementById("errors").lastChild);
          };
          var h3 = document.getElementById("errors").appendChild(document.createElement("h3"));
          h3.appendChild(document.createTextNode("YOU WON!"));
          document.getElementById("errors").appendChild(pic);
          document.getElementById("guess-container").innerHTML = '<button class="btn btn-success btn-lg" type="submit">Play again?</button>';
        };
      }
      else {
        wrongAlert();
        guessCount--;
        document.getElementById("guess-box").value = "";
        if (guessCount == 0) alert("You lost. Sad Face."); //WHAT ELSE HAPPENS IF THEY LOSE
      }
      document.getElementById("guess-box").focus();
      return guess;
    };

    function decode(icon, letter) {
      var newSecret = thisSecret.map( function(word, i, ary) { 
        if (word == icon) {
          return letter.toUpperCase(); 
        }
        else {
          return word;
        }
      });
      return newSecret;
    };

  </script>

</body>
</html>

<!-- 

-->
